<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Copycenter Antar Kita - Pencatatan Kas (Dengan PIN)</title>
  <style>
    :root{--bg:#f7f8fb;--card:#fff;--accent:#164e63;--muted:#6b7280}
    *{box-sizing:border-box;font-family:Inter,ui-sans-serif,system-ui,Segoe UI,Roboto,'Helvetica Neue',Arial}
    body{margin:0;padding:18px;background:linear-gradient(180deg,#f3f4f6, #ffffff);color:#0f172a}
    .wrap{max-width:980px;margin:0 auto}
    header{display:flex;gap:12px;align-items:center;justify-content:space-between}
    h1{font-size:20px;margin:0}
    p.lead{margin:4px 0 18px;color:var(--muted)}
    .grid{display:grid;grid-template-columns:1fr 360px;gap:18px}
    @media(max-width:880px){.grid{grid-template-columns:1fr} .actions-row{flex-wrap:wrap}}
    .card{background:var(--card);padding:14px;border-radius:12px;box-shadow:0 6px 18px rgba(12,15,30,0.06)}
    label{display:block;font-size:13px;color:var(--muted);margin-bottom:6px}
    input,select,textarea{width:100%;padding:8px;border-radius:8px;border:1px solid #e6e9ef;font-size:14px}
    .row{display:flex;gap:8px}
    .row .col{flex:1}
    button{background:var(--accent);color:#fff;border:0;padding:10px 12px;border-radius:10px;font-weight:600;cursor:pointer}
    button.ghost{background:transparent;border:1px solid #e6e9ef;color:var(--accent)}
    .totals{display:flex;gap:8px;flex-wrap:wrap}
    .stat{flex:1;padding:12px;border-radius:10px;background:linear-gradient(180deg,#fff,#fbfdff);text-align:center}
    table{width:100%;border-collapse:collapse;margin-top:12px}
    th,td{padding:8px;border-bottom:1px solid #eef2f7;font-size:13px;text-align:left}
    .muted{color:var(--muted);font-size:13px}
    .actions-row{display:flex;gap:8px;align-items:center}
    .small{font-size:13px;padding:6px 8px;border-radius:8px}
    footer{margin-top:14px;color:var(--muted);font-size:13px}
    .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,0.36);z-index:30}
    .modal .box{width:820px;max-width:96%;background:#fff;padding:14px;border-radius:10px}
  </style>
</head>
<body>
  <!-- PIN Login Overlay -->
  <div id="pinOverlay" style="position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.6);z-index:9999">
    <div style="background:#fff;padding:20px;border-radius:12px;max-width:360px;width:94%;text-align:center;box-shadow:0 10px 30px rgba(0,0,0,0.3)">
      <h2 style="margin:0 0 8px">Masuk — Copycenter Antar Kita</h2>
      <p style="margin:0 0 12px;color:#555">Masukkan PIN 4 digit untuk melanjutkan</p>
      <input id="pinInput" type="password" inputmode="numeric" maxlength="6" style="font-size:20px;padding:10px;width:100%;border-radius:8px;border:1px solid #ddd;text-align:center" placeholder="●●●●" />
      <div style="display:flex;gap:8px;margin-top:12px;justify-content:center">
        <button id="pinSubmit" style="padding:8px 12px;border-radius:8px;border:none;background:var(--accent);color:#fff;cursor:pointer">Masuk</button>
        <button id="pinCancel" class="ghost small" style="padding:8px 12px;border-radius:8px;border:1px solid #e6e9ef;background:transparent;cursor:pointer">Keluar</button>
      </div>
      <p id="pinError" style="color:#c53030;margin-top:10px;display:none"></p>
      <div style="margin-top:10px;font-size:12px;color:#666">PIN default: <strong>1234</strong>. Kamu bisa ganti PIN di <em>Pengaturan</em>.</div>
    </div>
  </div>

  <div class="wrap">
    <header>
      <div>
        <h1>Copycenter Antar Kita — Pencatatan Pemasukan & Pengeluaran</h1>
        <p class="lead">Cepat catat transaksi penjualan & biaya harian. Cocok untuk usaha fotokopi dan print dekat kampus.</p>
      </div>
      <div class="actions-row">
        <button id="btnExport" class="small">Export CSV</button>
        <button id="btnImport" class="small ghost">Import CSV</button>
        <input id="fileInput" type="file" accept=".csv" style="display:none" />
        <button id="btnSettings" class="small ghost">Pengaturan</button>
        <button id="btnClear" class="small ghost">Hapus Semua</button>
      </div>
    </header>

    <main class="grid" style="margin-top:14px">
      <section class="card">
        <h2 style="font-size:16px;margin:0 0 12px">Tambah Transaksi</h2>

        <div style="margin-bottom:12px">
          <label>Jenis</label>
          <select id="type">
            <option value="sale">Penjualan (fotokopi / print)</option>
            <option value="expense">Pengeluaran</option>
          </select>
        </div>

        <div id="saleForm">
          <label>Nama Item / Layanan</label>
          <input id="item" placeholder="Contoh: Fotokopi A4 (1 lembar)" />
          <div class="row" style="margin-top:8px">
            <div class="col">
              <label>Jumlah</label>
              <input id="qty" type="number" min="1" value="1" />
            </div>
            <div class="col">
              <label>Harga per Unit (Rp)</label>
              <input id="price" type="number" min="0" value="1500" />
            </div>
          </div>
        </div>

        <div id="expenseForm" style="display:none">
          <label>Deskripsi Pengeluaran</label>
          <input id="expDesc" placeholder="Contoh: Kertas A4, Tinta" />
          <label style="margin-top:8px">Kategori</label>
          <select id="expCat">
            <option>Operasional</option>
            <option>Perlengkapan</option>
            <option>Gaji</option>
            <option>Lainnya</option>
          </select>
          <label style="margin-top:8px">Jumlah (Rp)</label>
          <input id="expAmount" type="number" min="0" value="50000" />
        </div>

        <div style="display:flex;gap:8px;margin-top:12px">
          <button id="btnAdd">Tambah</button>
          <button id="btnAddQuick" class="ghost">Tambah Cepat (Rp 1.500 x 1)</button>
        </div>

        <div style="margin-top:12px" class="muted">Tips: gunakan 'Tambah Cepat' untuk mencatat fotokopi per lembar cepat.</div>

        <div style="margin-top:18px">
          <h3 style="margin:0 0 8px">Ringkasan</h3>
          <div class="totals">
            <div class="stat"><h3>Pemasukan</h3><p id="totalIncome">Rp 0</p></div>
            <div class="stat"><h3>Pengeluaran</h3><p id="totalExpense">Rp 0</p></div>
            <div class="stat"><h3>Keuntungan</h3><p id="totalProfit">Rp 0</p></div>
          </div>
        </div>
      </section>

      <aside class="card">
        <h3 style="margin:0 0 10px">Buku Kas / Ledger</h3>
        <div style="max-height:520px;overflow:auto">
          <table id="ledger">
            <thead><tr><th>Tgl</th><th>Keterangan</th><th>Debit</th><th>Kredit</th><th></th></tr></thead>
            <tbody></tbody>
          </table>
        </div>
        <div style="margin-top:10px;display:flex;gap:8px">
          <button id="btnToday" class="small">Filter Hari Ini</button>
          <button id="btnAll" class="small ghost">Tampilkan Semua</button>
        </div>
        <footer>
          <div class="muted" style="margin-top:8px">Data tersimpan di browser (localStorage). Untuk backup, gunakan Export CSV.</div>
        </footer>
      </aside>
    </main>
  </div>

  <!-- Settings Modal -->
  <div id="settingsModal" class="modal"><div class="box">
    <div style="display:flex;justify-content:space-between;align-items:center"><h3 style="margin:0">Pengaturan</h3><button id="closeSettings" class="small ghost">Tutup</button></div>
    <div style="margin-top:12px">
      <label>Warna Tema (Accent)</label>
      <input id="themeColor" type="color" value="#164e63" />
      <div style="margin-top:12px">
        <label>PIN Akses (4+ digit)</label>
        <div style="display:flex;gap:8px;margin-top:6px">
          <input id="newPinField" placeholder="Masukkan PIN baru" style="flex:1;padding:8px;border-radius:8px;border:1px solid #e6e9ef" />
          <button id="savePinBtn" class="small">Simpan PIN</button>
        </div>
        <div style="margin-top:8px;display:flex;gap:8px;align-items:center">
          <label class="muted-small">Kunci Aplikasi</label>
          <select id="pinEnabledSelect" style="padding:6px;border-radius:8px;border:1px solid #e6e9ef">
            <option value="true">Aktif</option>
            <option value="false">Non-aktif</option>
          </select>
        </div>
        <div class="muted-small" style="margin-top:8px">Jika non-aktif, tidak perlu PIN saat membuka situs. Default: aktif (PIN 1234).</div>
      </div>
    </div>
  </div></div>

  <script>
    // storage + UI logic
    const $ = id => document.getElementById(id)
    let data = JSON.parse(localStorage.getItem('copycenter_data')||'[]')

    function formatIDR(n){ if(!n && n!==0) return 'Rp 0'; return 'Rp ' + Number(n).toLocaleString('id-ID') }
    function nowIso(){return new Date().toISOString()}
    function save(){localStorage.setItem('copycenter_data', JSON.stringify(data)); render()}

    const ledgerTbody = document.querySelector('#ledger tbody')
    function render(filterToday=false){
      ledgerTbody.innerHTML=''
      let income=0, expense=0
      const rows = data.filter(tx=>{
        if(!filterToday) return true
        const d=new Date(tx.t); const today=new Date()
        return d.getFullYear()==today.getFullYear() && d.getMonth()==today.getMonth() && d.getDate()==today.getDate()
      })
      rows.slice().reverse().forEach((tx,i)=>{
        const tr=document.createElement('tr')
        const date=new Date(tx.t)
        const desc = tx.type=='sale' ? `${tx.item} (x${tx.qty})` : `${tx.desc} — ${tx.cat}`
        const debit = tx.type=='sale' ? formatIDR(tx.total) : ''
        const credit = tx.type=='expense' ? formatIDR(tx.amount) : ''
        if(tx.type=='sale') income+=Number(tx.total)
        if(tx.type=='expense') expense+=Number(tx.amount)
        tr.innerHTML = `<td>${date.toLocaleString()}</td><td>${desc}</td><td>${debit}</td><td>${credit}</td><td><button data-i='${data.length-1-i}' class='small ghost'>Hapus</button></td>`
        ledgerTbody.appendChild(tr)
      })
      $('totalIncome').textContent = formatIDR(income)
      $('totalExpense').textContent = formatIDR(expense)
      $('totalProfit').textContent = formatIDR(income-expense)
      ledgerTbody.querySelectorAll('button').forEach(b=> b.addEventListener('click', e=>{ const idx=Number(e.currentTarget.dataset.i); if(confirm('Hapus transaksi?')){ data.splice(idx,1); save(); } }))
    }
    render()

    // form handlers
    $('type').addEventListener('change', e=>{ if(e.target.value=='sale'){ $('saleForm').style.display='block'; $('expenseForm').style.display='none' } else { $('saleForm').style.display='none'; $('expenseForm').style.display='block' } })
    function addTx(){ const type=$('type').value; if(type=='sale'){ const item=$('item').value.trim()||'Penjualan'; const qty=Number($('qty').value)||1; const price=Number($('price').value)||0; const total=qty*price; data.push({type:'sale', item, qty, price, total, t:nowIso()}) } else { const desc=$('expDesc').value.trim()||'Pengeluaran'; const cat=$('expCat').value; const amount=Number($('expAmount').value)||0; data.push({type:'expense', desc, cat, amount, t:nowIso()}) } save(); $('item').value=''; $('qty').value=1; $('price').value=1500; $('expDesc').value=''; $('expAmount').value=50000 }
    $('btnAdd').addEventListener('click', addTx)
    $('btnAddQuick').addEventListener('click', ()=>{ $('type').value='sale'; $('type').dispatchEvent(new Event('change')); $('item').value='Fotokopi (1 lembar)'; $('qty').value=1; $('price').value=1500; addTx() })

    // export CSV
    function exportCSV(){ if(!data.length){ alert('Tidak ada data untuk diexport.'); return } const rows=[['tanggal','tipe','keterangan','debit','kredit']] ; data.forEach(tx=>{ const t=new Date(tx.t).toLocaleString(); if(tx.type=='sale') rows.push([t,'Penjualan',tx.item + ' x'+tx.qty,tx.total,'']); else rows.push([t,'Pengeluaran',tx.desc + ' ('+tx.cat+')','',tx.amount]) }) const csv = rows.map(r=>r.map(c=>`"${String(c).replace(/"/g,'""')}"`).join(',')).join('\n'); const blob=new Blob([csv],{type:'text/csv'}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download=`copycenter_data_${new Date().toISOString().slice(0,10)}.csv`; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url) }
    $('btnExport').addEventListener('click', exportCSV)

    // import CSV (simple parser)
    $('btnImport').addEventListener('click', ()=>$('fileInput').click())
    function parseCSV(text){ const rows=[]; let cur=''; let row=[]; let inQuotes=false; for(let i=0;i<text.length;i++){ const ch=text[i]; const nxt=text[i+1]; if(ch==='"'){ if(inQuotes && nxt==='"'){ cur+='"'; i++; continue } inQuotes=!inQuotes; continue } if(ch===',' && !inQuotes){ row.push(cur); cur=''; continue } if((ch==='\n' || ch==='\r') && !inQuotes){ if(cur!=='' || row.length>0){ row.push(cur); cur=''; rows.push(row); row=[] } continue } cur+=ch } if(cur!=='' || row.length>0){ row.push(cur); rows.push(row) } return rows }

    $('fileInput').addEventListener('change', async (e)=>{ const f=e.target.files[0]; if(!f) return; const text=await f.text(); const rows=parseCSV(text).map(r=>r.map(c=>c.trim())); if(rows.length<2){ alert('File CSV kosong atau format tidak dikenali.'); return } const header=rows[0].map(h=>String(h||'').trim().toLowerCase().replace(/\s+/g,'')); const idx={}; header.forEach((h,i)=>{ if(['tanggal','date','tgl','time'].includes(h)) idx.t=i; if(['tipe','type'].includes(h)) idx.type=i; if(['keterangan','desc','keterangan','description'].includes(h)) idx.desc=i; if(['debit','income','masuk'].includes(h)) idx.debit=i; if(['kredit','credit','expense','keluar'].includes(h)) idx.credit=i }); if(idx.t===undefined) idx.t=0; if(idx.type===undefined) idx.type=1; if(idx.desc===undefined) idx.desc=2; if(idx.debit===undefined) idx.debit=3; if(idx.credit===undefined) idx.credit=4; const replace = confirm('Apakah ingin MENGGANTI semua data yang ada sekarang? (OK = Ganti, Cancel = Tambah/Merge)'); const imported=[]; for(let i=1;i<rows.length;i++){ const r=rows[i]; if(r.length===0) continue; const tRaw=r[idx.t]||''; const typeRaw=(r[idx.type]||'').toLowerCase(); const descRaw=r[idx.desc]||''; const debitRaw=(r[idx.debit]||'').replace(/[^0-9\-\.]/g,''); const creditRaw=(r[idx.credit]||'').replace(/[^0-9\-\.]/g,''); let t=new Date(tRaw); if(isNaN(t)) t=new Date(); if((debitRaw && Number(debitRaw)>0) || typeRaw.includes('penjualan') || typeRaw.includes('sale')){ let item=descRaw; let qty=1; const m=descRaw.match(/(.*)\s+x\s*(\d+)$/i); if(m){ item=m[1].trim(); qty=Number(m[2]) } const total=Number(debitRaw)||0; let price=total; if(qty>0) price = qty? Math.round(total/qty) : total; imported.push({type:'sale', item:item||'Penjualan', qty:qty||1, price:price||total, total:total, t:t.toISOString()}) } else if((creditRaw && Number(creditRaw)>0) || typeRaw.includes('pengeluaran') || typeRaw.includes('expense')){ const amount=Number(creditRaw)||0; let cat='Lainnya'; const cm=descRaw.match(/\(([^)]+)\)/); if(cm) cat=cm[1]; imported.push({type:'expense', desc:descRaw||'Pengeluaran', cat:cat, amount:amount, t:t.toISOString()}) } else continue } if(!imported.length){ alert('Tidak ada transaksi valid yang terdeteksi di file CSV. Pastikan format sesuai Export CSV dari aplikasi ini.'); return } if(replace) data = imported; else data = data.concat(imported); save(); alert('Import berhasil: ' + imported.length + ' transaksi.'); e.target.value='' })

    // clear
    $('btnClear').addEventListener('click', ()=>{ if(confirm('Yakin hapus semua data? Ini tidak bisa dibatalkan.')){ data=[]; save(); } })

    // filters
    $('btnToday').addEventListener('click', ()=>render(true))
    $('btnAll').addEventListener('click', ()=>render(false))

    // settings modal
    $('btnSettings').addEventListener('click', ()=>{ $('settingsModal').style.display='flex'; })
    $('closeSettings').addEventListener('click', ()=>{ $('settingsModal').style.display='none'; })

    // theme color in settings
    $('themeColor').addEventListener('input', e=>{ document.documentElement.style.setProperty('--accent', e.target.value); localStorage.setItem('copycenter_theme', e.target.value) })
    // initialize theme from storage
    (function(){ const t=localStorage.getItem('copycenter_theme')||'#164e63'; document.documentElement.style.setProperty('--accent', t); $('themeColor').value=t })()

    // PIN logic (storage & UI controls)
    (function(){
      const overlay = document.getElementById('pinOverlay')
      const input = document.getElementById('pinInput')
      const submit = document.getElementById('pinSubmit')
      const cancel = document.getElementById('pinCancel')
      const error = document.getElementById('pinError')

      function getPin(){ return localStorage.getItem('copycenter_pin') || '1234' }
      function setPin(v){ localStorage.setItem('copycenter_pin', v) }

      const pinEnabled = JSON.parse(localStorage.getItem('copycenter_pin_enabled') || 'true')

      function unlockUI(){ overlay.style.display='none'; const it=document.getElementById('item'); if(it) it.focus() }
      function lockUI(){ overlay.style.display='flex'; input.value=''; input.focus() }

      if(!pinEnabled) overlay.style.display='none'; else lockUI()

      submit.addEventListener('click', ()=>{
        const val=(input.value||'').trim()
        if(!val){ error.textContent='Masukkan PIN'; error.style.display='block'; return }
        if(val === getPin()){ error.style.display='none'; unlockUI() } else { error.textContent='PIN salah — coba lagi'; error.style.display='block'; input.value=''; input.focus() }
      })
      input.addEventListener('keydown', (e)=>{ if(e.key==='Enter') submit.click() })
      cancel.addEventListener('click', ()=>{ window.location.href='https://github.com' })

      // settings handlers: save pin & toggle
      const saveBtn = document.getElementById('savePinBtn')
      const newPin = document.getElementById('newPinField')
      const enabledSel = document.getElementById('pinEnabledSelect')
      if(saveBtn){
        saveBtn.addEventListener('click', ()=>{
          const v = (newPin.value||'').trim()
          if(v.length<4){ alert('PIN harus minimal 4 digit'); return }
          setPin(v); localStorage.setItem('copycenter_pin_enabled','true'); alert('PIN berhasil diubah'); newPin.value=''
        })
      }
      if(enabledSel){
        const stored = localStorage.getItem('copycenter_pin_enabled') || 'true'
        enabledSel.value = stored
        enabledSel.addEventListener('change', ()=>{
          const val = enabledSel.value === 'true'
          localStorage.setItem('copycenter_pin_enabled', val? 'true':'false')
          if(val) lockUI(); else overlay.style.display='none'
          alert('Setelan kunci disimpan: ' + (val? 'Aktif' : 'Non-aktif'))
        })
      }
    })()

    // keep rendering if storage changed elsewhere
    window.addEventListener('storage', ()=>{ data = JSON.parse(localStorage.getItem('copycenter_data')||'[]'); render() })
  </script>
</body>
</html>
