<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Copycenter Antar Kita — Dashboard</title>
  <style>
    :root{
      --bg: #f7f8fb;
      --card: #ffffff;
      --text: #0f172a;
      --muted: #6b7280;
      --accent: #0b5d6f;
      --card-2: #f8fafc;
    }
    [data-theme="dark"]{
      --bg: #0b1220;
      --card: #071022;
      --text: #e6eef6;
      --muted: #9aa6b2;
      --accent: #2dd4bf;
      --card-2: #071b2b;
    }
    *{box-sizing:border-box;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial}
    body{margin:0;background:linear-gradient(180deg,var(--bg),#ffffff);color:var(--text);padding:18px}
    .center{max-width:1100px;margin:0 auto}
    header{display:flex;justify-content:space-between;align-items:center;gap:12px}
    .brand{display:flex;align-items:center;gap:12px}
    .logo{width:48px;height:48px;border-radius:10px;background:linear-gradient(135deg,var(--accent),#08323a);display:flex;align-items:center;justify-content:center;color:#fff;font-weight:700;font-size:18px}
    h1{font-size:18px;margin:0}
    p.lead{margin:0;color:var(--muted);font-size:13px}
    .actions{display:flex;gap:8px;align-items:center}
    button{background:var(--accent);color:#fff;border:0;padding:8px 12px;border-radius:8px;cursor:pointer;font-weight:600}
    button.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--accent)}
    .grid{display:grid;grid-template-columns:360px 1fr;gap:18px;margin-top:18px}
    .card{background:var(--card);padding:14px;border-radius:12px;box-shadow:0 6px 18px rgba(2,6,23,0.06)}
    label{display:block;font-size:13px;color:var(--muted);margin-bottom:6px}
    input,select,textarea{width:100%;padding:8px;border-radius:8px;border:1px solid #e6e9ef;background:transparent;color:var(--text)}
    table{width:100%;border-collapse:collapse;margin-top:12px}
    th,td{padding:8px;border-bottom:1px solid #e6e9ef;font-size:13px;text-align:left}
    .muted{color:var(--muted);font-size:13px}
    .stat{padding:12px;border-radius:10px;background:linear-gradient(180deg,var(--card),var(--card-2));text-align:center}
    .stat h3{margin:0;font-size:14px}
    .stat p{margin:6px 0 0;font-weight:700}
    .small{font-size:13px;padding:6px 8px;border-radius:8px}
    .login-page{min-height:100vh;display:flex;align-items:center;justify-content:center;background:linear-gradient(180deg,var(--bg),#eaf6f5)}
    .login-card{width:420px;background:var(--card);padding:22px;border-radius:12px;box-shadow:0 20px 50px rgba(2,6,23,0.12);text-align:center}
    .logo-large{width:72px;height:72px;border-radius:12px;background:linear-gradient(135deg,var(--accent),#08323a);display:flex;align-items:center;justify-content:center;color:#fff;font-weight:800;font-size:26px;margin:0 auto 10px}
    .muted-small{font-size:13px;color:var(--muted)}
    canvas{max-width:100%;height:240px}
    footer{margin-top:18px;color:var(--muted);font-size:13px;text-align:center}
    @media(max-width:900px){ .grid{grid-template-columns:1fr} .login-card{width:92%} }
  </style>
</head>
<body>
  <!-- LOGIN PAGE (shown first) -->
  <div id="loginRoot" class="login-page" style="display:flex">
    <div class="login-card">
      <div class="logo-large">CC</div>
      <h2 style="margin:6px 0">Copycenter Antar Kita</h2>
      <p class="muted-small">Masukkan PIN untuk mengakses dashboard pencatatan</p>
      <div style="margin-top:12px">
        <input id="loginPin" type="password" placeholder="PIN 4 digit" style="font-size:18px;padding:10px;border-radius:8px;text-align:center" maxlength="6" inputmode="numeric">
      </div>
      <div style="display:flex;gap:8px;justify-content:center;margin-top:12px">
        <button id="loginBtn">Masuk</button>
        <button id="visitBtn" class="ghost">Batal</button>
      </div>
      <p id="loginErr" class="muted-small" style="color:#c53030;display:none;margin-top:10px"></p>
      <p style="margin-top:12px" class="muted-small">PIN default: <strong>1234</strong>. Ubah di Pengaturan.</p>
    </div>
  </div>

  <!-- APP ROOT -->
  <div id="appRoot" class="center" style="display:none">
    <header>
      <div class="brand">
        <div class="logo">CC</div>
        <div>
          <h1>Copycenter Antar Kita</h1>
          <p class="lead">Pencatatan penjualan & pengeluaran — cepat untuk usaha fotokopi dekat kampus</p>
        </div>
      </div>
      <div class="actions">
        <label class="muted-small" style="margin-right:6px">Tema</label>
        <select id="themeSelect" class="small" style="padding:6px;border-radius:8px;border:1px solid #e6e9ef">
          <option value="light">Light</option>
          <option value="dark">Dark</option>
        </select>
        <button id="btnExport" class="small">Export CSV</button>
        <button id="btnSettings" class="small ghost">Pengaturan</button>
      </div>
    </header>

    <main class="grid">
      <aside class="card">
        <h3 style="margin:0 0 12px">Tambah Transaksi</h3>
        <label>Jenis</label>
        <select id="type">
          <option value="sale">Penjualan</option>
          <option value="expense">Pengeluaran</option>
        </select>
        <div id="saleForm" style="margin-top:8px">
          <label>Nama Item / Layanan</label>
          <input id="item" placeholder="Contoh: Fotokopi A4 (1 lembar)" />
          <div class="row" style="display:flex;gap:8px;margin-top:8px">
            <input id="qty" type="number" min="1" value="1" style="flex:1" />
            <input id="price" type="number" min="0" value="1500" style="flex:1" />
          </div>
        </div>
        <div id="expenseForm" style="display:none;margin-top:8px">
          <label>Deskripsi</label>
          <input id="expDesc" placeholder="Contoh: Kertas A4, Tinta" />
          <label style="margin-top:8px">Kategori</label>
          <select id="expCat"><option>Operasional</option><option>Perlengkapan</option><option>Gaji</option><option>Lainnya</option></select>
          <label style="margin-top:8px">Jumlah (Rp)</label>
          <input id="expAmount" type="number" min="0" value="50000" />
        </div>

        <div style="display:flex;gap:8px;margin-top:12px">
          <button id="btnAdd">Tambah</button>
          <button id="btnQuick" class="ghost">Tambah Cepat</button>
        </div>

        <div style="margin-top:18px">
          <h4 style="margin:0 0 8px">Ringkasan</h4>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
            <div class="stat"><h3>Pemasukan</h3><p id="totalIncome">Rp 0</p></div>
            <div class="stat"><h3>Pengeluaran</h3><p id="totalExpense">Rp 0</p></div>
            <div class="stat" style="grid-column:1 / -1"><h3>Keuntungan</h3><p id="totalProfit">Rp 0</p></div>
          </div>
        </div>
      </aside>

      <section class="card">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <h3 style="margin:0">Dashboard</h3>
          <div style="display:flex;gap:8px;align-items:center">
            <label class="muted-small">Periode</label>
            <select id="periodSelect" class="small">
              <option value="7">7 hari</option>
              <option value="30">30 hari</option>
              <option value="90">90 hari</option>
            </select>
            <button id="btnExportReport" class="small ghost">Export Laporan</button>
          </div>
        </div>

        <div style="margin-top:12px">
          <canvas id="chartCanvas" width="800" height="240"></canvas>
        </div>

        <div style="margin-top:12px">
          <h4 style="margin:0 0 8px">Buku Kas</h4>
          <div style="max-height:280px;overflow:auto">
            <table id="ledger"><thead><tr><th>Tgl</th><th>Keterangan</th><th>Debit</th><th>Kredit</th><th></th></tr></thead><tbody></tbody></table>
          </div>
        </div>
      </section>
    </main>

    <!-- Settings modal -->
    <div id="settingsModal" class="modal"><div class="box">
      <div style="display:flex;justify-content:space-between;align-items:center"><h3 style="margin:0">Pengaturan</h3><button id="closeSettings" class="small ghost">Tutup</button></div>
      <div style="margin-top:12px">
        <label>Warna Tema (Accent)</label>
        <input id="themeColor" type="color" value="#0b5d6f" />
        <div style="margin-top:12px">
          <label>PIN Akses (4+ digit)</label>
          <div style="display:flex;gap:8px;margin-top:6px">
            <input id="newPinField" placeholder="Masukkan PIN baru" style="flex:1;padding:8px;border-radius:8px;border:1px solid #e6e9ef" />
            <button id="savePinBtn" class="small">Simpan PIN</button>
          </div>
          <div style="margin-top:8px;display:flex;gap:8px;align-items:center">
            <label class="muted-small">Kunci Aplikasi</label>
            <select id="pinEnabledSelect" style="padding:6px;border-radius:8px;border:1px solid #e6e9ef">
              <option value="true">Aktif</option>
              <option value="false">Non-aktif</option>
            </select>
          </div>
        </div>
      </div>
    </div>

    <footer>Copycenter Antar Kita — aplikasi pencatatan sederhana. Data tersimpan di browser Anda.</footer>
  </div>

<script>
// ---------- storage & helpers ----------
const $ = id => document.getElementById(id)
let data = JSON.parse(localStorage.getItem('copycenter_data')||'[]')
function formatIDR(n){ if(!n && n!==0) return 'Rp 0'; return 'Rp '+Number(n).toLocaleString('id-ID') }
function nowIso(){ return new Date().toISOString() }
function save(){ localStorage.setItem('copycenter_data', JSON.stringify(data)); render(); renderChart(); }

// ---------- UI render ----------
const ledgerTbody = document.querySelector('#ledger tbody')
function render(filterToday=false){
  ledgerTbody.innerHTML=''
  let income=0, expense=0
  const rows = data.filter(tx=>{
    if(!filterToday) return true
    const d=new Date(tx.t); const today=new Date()
    return d.getFullYear()==today.getFullYear() && d.getMonth()==today.getMonth() && d.getDate()==today.getDate()
  })
  rows.slice().reverse().forEach((tx,i)=>{
    const tr=document.createElement('tr')
    const date=new Date(tx.t)
    const desc = tx.type=='sale' ? `${tx.item} (x${tx.qty})` : `${tx.desc} — ${tx.cat}`
    const debit = tx.type=='sale' ? formatIDR(tx.total) : ''
    const credit = tx.type=='expense' ? formatIDR(tx.amount) : ''
    if(tx.type=='sale') income+=Number(tx.total)
    if(tx.type=='expense') expense+=Number(tx.amount)
    tr.innerHTML = `<td>${date.toLocaleString()}</td><td>${desc}</td><td>${debit}</td><td>${credit}</td><td><button data-i='${data.length-1-i}' class='small ghost'>Hapus</button></td>`
    ledgerTbody.appendChild(tr)
  })
  $('totalIncome').textContent = formatIDR(income)
  $('totalExpense').textContent = formatIDR(expense)
  $('totalProfit').textContent = formatIDR(income-expense)
  ledgerTbody.querySelectorAll('button').forEach(b=> b.addEventListener('click', e=>{ const idx=Number(e.currentTarget.dataset.i); if(confirm('Hapus transaksi?')){ data.splice(idx,1); save(); } }))
}

// ---------- form handlers ----------
$('type').addEventListener('change', e=>{ if(e.target.value=='sale'){ $('saleForm').style.display='block'; $('expenseForm').style.display='none' } else { $('saleForm').style.display='none'; $('expenseForm').style.display='block' } })
function addTx(){ const type=$('type').value; if(type=='sale'){ const item=$('item').value.trim()||'Penjualan'; const qty=Number($('qty').value)||1; const price=Number($('price').value)||0; const total=qty*price; data.push({type:'sale', item, qty, price, total, t:nowIso()}) } else { const desc=$('expDesc').value.trim()||'Pengeluaran'; const cat=$('expCat').value; const amount=Number($('expAmount').value)||0; data.push({type:'expense', desc, cat, amount, t:nowIso()}) } save(); $('item').value=''; $('qty').value=1; $('price').value=1500; $('expDesc').value=''; $('expAmount').value=50000 }
$('btnAdd').addEventListener('click', addTx)
$('btnQuick').addEventListener('click', ()=>{ $('type').value='sale'; $('type').dispatchEvent(new Event('change')); $('item').value='Fotokopi (1 lembar)'; $('qty').value=1; $('price').value=1500; addTx() })

// ---------- export CSV ----------
$('btnExport').addEventListener('click', ()=>{
  if(!data.length){ alert('Tidak ada data untuk diexport.'); return }
  const rows=[['tanggal','tipe','keterangan','debit','kredit']]
  data.forEach(tx=>{ const t=new Date(tx.t).toLocaleString(); if(tx.type=='sale') rows.push([t,'Penjualan',tx.item+' x'+tx.qty,tx.total,'']); else rows.push([t,'Pengeluaran',tx.desc+' ('+tx.cat+')','',tx.amount]) })
  const csv = rows.map(r=>r.map(c=>`"${String(c).replace(/"/g,'""')}"`).join(',')).join('\n')
  const blob = new Blob([csv],{type:'text/csv'}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download=`copycenter_data_${new Date().toISOString().slice(0,10)}.csv`; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url)
})

// ---------- import CSV ----------
const fileInput = document.createElement('input'); fileInput.type='file'; fileInput.accept='.csv'; fileInput.style.display='none'; document.body.appendChild(fileInput)
$('btnExportReport').addEventListener('click', ()=>{ exportReportCSV() })
$('btnSettings').addEventListener('click', ()=>{ $('settingsModal').style.display='flex' })
$('closeSettings').addEventListener('click', ()=>{ $('settingsModal').style.display='none' })

fileInput.addEventListener('change', async (e)=>{
  const f=e.target.files[0]; if(!f) return; const text = await f.text()
  const rows = parseCSV(text).map(r=>r.map(c=>c.trim())); if(rows.length<2){ alert('File CSV kosong atau format tidak dikenali.'); return }
  const header = rows[0].map(h=>String(h||'').trim().toLowerCase().replace(/\s+/g,''))
  const idx={}
  header.forEach((h,i)=>{ if(['tanggal','date','tgl','time'].includes(h)) idx.t=i; if(['tipe','type'].includes(h)) idx.type=i; if(['keterangan','desc','keterangan','description'].includes(h)) idx.desc=i; if(['debit','income','masuk'].includes(h)) idx.debit=i; if(['kredit','credit','expense','keluar'].includes(h)) idx.credit=i })
  if(idx.t===undefined) idx.t=0; if(idx.type===undefined) idx.type=1; if(idx.desc===undefined) idx.desc=2; if(idx.debit===undefined) idx.debit=3; if(idx.credit===undefined) idx.credit=4
  const replace = confirm('Apakah ingin MENGGANTI semua data yang ada sekarang? (OK = Ganti, Cancel = Tambah/Merge)')
  const imported=[]
  for(let i=1;i<rows.length;i++){
    const r=rows[i]; if(r.length===0) continue
    const tRaw=r[idx.t]||''; const typeRaw=(r[idx.type]||'').toLowerCase(); const descRaw=r[idx.desc]||''
    const debitRaw=(r[idx.debit]||'').replace(/[^0-9\-\.]/g,''); const creditRaw=(r[idx.credit]||'').replace(/[^0-9\-\.]/g,'')
    let t=new Date(tRaw); if(isNaN(t)) t=new Date()
    if((debitRaw && Number(debitRaw)>0) || typeRaw.includes('penjualan') || typeRaw.includes('sale')){
      let item=descRaw; let qty=1; const m=descRaw.match(/(.*)\s+x\s*(\d+)$/i); if(m){ item=m[1].trim(); qty=Number(m[2]) }
      const total=Number(debitRaw)||0; let price=total; if(qty>0) price = qty? Math.round(total/qty) : total
      imported.push({type:'sale', item:item||'Penjualan', qty:qty||1, price:price||total, total:total, t:t.toISOString()})
    } else if((creditRaw && Number(creditRaw)>0) || typeRaw.includes('pengeluaran') || typeRaw.includes('expense')){
      const amount=Number(creditRaw)||0; let cat='Lainnya'; const cm=descRaw.match(/\(([^)]+)\)/); if(cm) cat=cm[1]
      imported.push({type:'expense', desc:descRaw||'Pengeluaran', cat:cat, amount:amount, t:t.toISOString()})
    } else continue
  }
  if(!imported.length){ alert('Tidak ada transaksi valid yang terdeteksi di file CSV.'); return }
  if(replace) data = imported; else data = data.concat(imported)
  save(); alert('Import berhasil: '+imported.length+' transaksi.'); e.target.value=''
})

// hook for upload button
$('btnImport').addEventListener('click', ()=> fileInput.click())

// simple CSV parser
function parseCSV(text){ const rows=[]; let cur=''; let row=[]; let inQuotes=false; for(let i=0;i<text.length;i++){ const ch=text[i]; const nxt=text[i+1]; if(ch==='"'){ if(inQuotes && nxt==='"'){ cur+='"'; i++; continue } inQuotes=!inQuotes; continue } if(ch===',' && !inQuotes){ row.push(cur); cur=''; continue } if((ch==='\n' || ch==='\r') && !inQuotes){ if(cur!=='' || row.length>0){ row.push(cur); cur=''; rows.push(row); row=[] } continue } cur+=ch } if(cur!=='' || row.length>0){ row.push(cur); rows.push(row) } return rows }

// ---------- REPORT export ----------
function exportReportCSV(){
  const period = Number($('periodSelect').value)
  const now = new Date(); const from = new Date(now.getTime() - (period-1)*24*60*60*1000); from.setHours(0,0,0,0)
  const map = {}
  data.forEach(tx=>{
    const d = new Date(tx.t); if(d<from) return
    const key = d.toLocaleDateString()
    if(!map[key]) map[key] = {income:0, expense:0}
    if(tx.type==='sale') map[key].income += Number(tx.total)
    if(tx.type==='expense') map[key].expense += Number(tx.amount)
  })
  const rows=[['tanggal','pemasukan','pengeluaran','keuntungan']]
  Object.keys(map).sort().forEach(k=>{ const r=map[k]; rows.push([k, r.income, r.expense, r.income-r.expense]) })
  if(rows.length<=1){ alert('Tidak ada data untuk periode ini'); return }
  const csv = rows.map(r=>r.map(c=>`"${String(c).replace(/"/g,'""')}"`).join(',')).join('\n')
  const blob = new Blob([csv],{type:'text/csv'}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download=`copycenter_report_${new Date().toISOString().slice(0,10)}.csv`; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url)
}

// ---------- Theme (dark mode) ----------
function applyTheme(t){
  if(t==='dark') document.documentElement.setAttribute('data-theme','dark'); else document.documentElement.removeAttribute('data-theme')
  localStorage.setItem('copycenter_theme', t)
}
$('themeSelect').addEventListener('change', e=> applyTheme(e.target.value))
// init theme
(function(){ const t=localStorage.getItem('copycenter_theme')||'light'; $('themeSelect').value=t; applyTheme(t) })()

// ---------- PIN Login (login page) ----------
(function(){
  const loginRoot = $('loginRoot'), appRoot = $('appRoot'), loginBtn = $('loginBtn'), visitBtn = $('visitBtn'), loginPin = $('loginPin'), loginErr = $('loginErr')
  function getPin(){ return localStorage.getItem('copycenter_pin') || '1234' }
  function pinEnabled(){ return JSON.parse(localStorage.getItem('copycenter_pin_enabled')||'true') }
  function showApp(){ loginRoot.style.display='none'; appRoot.style.display='block'; render(); renderChart() }
  function showLogin(){ loginRoot.style.display='flex'; appRoot.style.display='none' }
  if(!pinEnabled()){ showApp(); return } // if disabled, show app directly
  // handlers
  loginBtn.addEventListener('click', ()=>{ const v = (loginPin.value||'').trim(); if(!v){ loginErr.style.display='block'; loginErr.textContent='Masukkan PIN'; return } if(v===getPin()){ loginErr.style.display='none'; showApp() } else { loginErr.style.display='block'; loginErr.textContent='PIN salah'; loginPin.value=''; loginPin.focus() } })
  visitBtn.addEventListener('click', ()=>{ window.location.href='https://github.com' })
  loginPin.addEventListener('keydown', e=>{ if(e.key==='Enter') loginBtn.click() })
})()

// ---------- PIN settings ----------
(function(){
  const saveBtn = $('savePinBtn'), newPin = $('newPinField'), enabledSel = $('pinEnabledSelect')
  if(saveBtn){
    saveBtn.addEventListener('click', ()=>{
      const v = (newPin.value||'').trim()
      if(v.length<4){ alert('PIN harus minimal 4 digit'); return }
      localStorage.setItem('copycenter_pin', v); localStorage.setItem('copycenter_pin_enabled','true'); alert('PIN berhasil diubah'); newPin.value=''
    })
  }
  if(enabledSel){
    enabledSel.value = localStorage.getItem('copycenter_pin_enabled') || 'true'
    enabledSel.addEventListener('change', ()=>{
      const val = enabledSel.value === 'true'
      localStorage.setItem('copycenter_pin_enabled', val? 'true':'false')
      alert('Setelan kunci disimpan: ' + (val? 'Aktif' : 'Non-aktif'))
    })
  }
})()

// ---------- Simple chart (canvas-based) ----------
const chartCanvas = $('chartCanvas'), ctx = chartCanvas.getContext('2d')
function renderChart(){
  // draw simple bar chart for last N days
  const period = Number($('periodSelect').value)
  const now = new Date(); const days = []
  for(let i=period-1;i>=0;i--){ const d=new Date(now.getTime()-i*24*60*60*1000); days.push(d) }
  const labels = days.map(d=>d.getDate()+'/'+(d.getMonth()+1))
  const incomeData = days.map(d=>0), expenseData = days.map(d=>0)
  data.forEach(tx=>{
    const d = new Date(tx.t); for(let i=0;i<days.length;i++){ const day=days[i]; if(d.getFullYear()==day.getFullYear() && d.getMonth()==day.getMonth() && d.getDate()==day.getDate()){ if(tx.type==='sale') incomeData[i]+=Number(tx.total); if(tx.type==='expense') expenseData[i]+=Number(tx.amount) } }
  })
  // clear canvas
  const w = chartCanvas.width = chartCanvas.clientWidth*devicePixelRatio
  const h = chartCanvas.height = 240*devicePixelRatio
  chartCanvas.style.height = '240px'
  ctx.clearRect(0,0,w,h)
  // margins
  const margin = {l:40*r(), r:20*r(), t:20*r(), b:40*r()}
  function r(){ return devicePixelRatio || 1 }
  const plotW = w - margin.l - margin.r
  const plotH = h - margin.t - margin.b
  // find max
  const maxVal = Math.max(1, ...incomeData, ...expenseData)
  const barW = plotW / labels.length * 0.38
  // draw y grid
  ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--text') || '#0f172a'
  ctx.font = (12*r())+'px serif'
  ctx.textAlign='right'
  ctx.textBaseline='middle'
  const ticks = 4
  for(let i=0;i<=ticks;i++){
    const y = margin.t + plotH - (i/ticks)*plotH
    const val = Math.round((i/ticks)*maxVal)
    ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--muted') || '#6b7280'
    ctx.fillText(formatIDR(val), margin.l-8*r(), y)
    // grid line
    ctx.strokeStyle = 'rgba(0,0,0,0.06)'
    ctx.beginPath(); ctx.moveTo(margin.l,y); ctx.lineTo(margin.l+plotW,y); ctx.stroke()
  }
  // draw bars
  labels.forEach((lab,i)=>{
    const x0 = margin.l + i*(plotW/labels.length) + (plotW/labels.length - 2*barW)/2
    const incomeH = (incomeData[i]/maxVal)*plotH
    const expenseH = (expenseData[i]/maxVal)*plotH
    // income bar (left)
    ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--accent') || '#0b5d6f'
    ctx.fillRect(x0, margin.t + plotH - incomeH, barW, incomeH)
    // expense bar (right)
    ctx.fillStyle = '#ef4444'
    ctx.fillRect(x0+barW+2*r(), margin.t + plotH - expenseH, barW, expenseH)
    // label
    ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--muted') || '#6b7280'
    ctx.textAlign='center'; ctx.textBaseline='top'; ctx.fillText(labels[i], x0+barW, margin.t+plotH+6*r())
  })
}

// update chart when period changes
$('periodSelect').addEventListener('change', renderChart)

// run initial render
render(); renderChart()

// responsive redraw on resize
window.addEventListener('resize', ()=> setTimeout(renderChart,120))
</script>
</body>
</html>
